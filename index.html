<script>
  const PADDLE_CLIENT_TOKEN = 'test_86bf96ddbab105199d721ee81ae';
  const PADDLE_PRICE_ID = 'pri_01kft4eh4rcjcx5pq2tvhwsw27';

  // Unlock state
  let hasPaid = localStorage.getItem('unlocked') === 'true';

  function setUnlocked(state) {
    hasPaid = state;
    if (state) localStorage.setItem('unlocked', 'true');
    else localStorage.removeItem('unlocked');
  }

  function initPaddle() {
    if (typeof Paddle === 'undefined') {
      console.error('Paddle SDK not loaded');
      return;
    }

    try {
      // Must be before any checkout call
      Paddle.Environment.set('sandbox');
      console.log('Paddle sandbox environment set');

      // Event callback is only needed for checkout completion
      // Note: latest SDK does not have Paddle.Initialize()
      // Checkout events are handled through global event listeners
      Paddle.Setup({ vendor: YOUR_VENDOR_ID }); // Optional: only if needed

      // Listen for checkout completion
      window.addEventListener('message', function(e) {
        if (!e.data || !e.data.event) return;
        if (e.data.event === 'Checkout.Complete') {
          console.log('Payment completed! Unlocking...');
          setUnlocked(true);
          // Refresh UI if needed
          if (typeof renderChecks === 'function') renderChecks();
        }
      });

    } catch (err) {
      console.error('Paddle initialization failed:', err);
    }
  }

  document.addEventListener('DOMContentLoaded', () => {
    initPaddle();

    const unlockBtn = document.getElementById('unlockBtn');
    unlockBtn.addEventListener('click', () => {
      Paddle.Checkout.open({
        product: PADDLE_PRICE_ID, // sandbox product
        // optional: email, passthrough, etc.
      });
    });
  });
</script>
