<!-- Steam Page Compliance Checker Frontend JS + Paddle Integration -->
<script src="https://cdn.paddle.com/paddle/paddle.js"></script>
<script>
/* ==============================================
   CONFIGURATION
   ============================================== */
const FREE_LIMIT = 3; // number of checks free users can run
let hasPaid = false;
let completedChecks = 0;

// Paddle Sandbox Credentials (from other utilities)
const PADDLE_CLIENT_TOKEN = 'test_c2deb3cb9b85f4b2afcd596c107';
const PADDLE_PRICE_ID = 'pri_01kfc8wsrhhqezk6htxdy7eppe';

/* ==============================================
   PADDLE INITIALIZATION
   ============================================== */
if (typeof Paddle !== 'undefined') {
    try {
        // Force sandbox mode
        Paddle.Environment.set('sandbox');
        console.log('Paddle environment set to sandbox');

        // Initialize Paddle billing
        Paddle.Initialize({
            token: PADDLE_CLIENT_TOKEN,
            eventCallback: function(data) {
                console.log('PADDLE EVENT:', data.name, data);

                // Unlock checks on successful payment
                if (data.name === 'checkout.completed') {
                    console.log('Payment completed! Unlocking all checks...');
                    hasPaid = true;

                    setTimeout(function() {
                        Paddle.Checkout.close();
                        renderChecks(); // refresh UI to unlock all
                    }, 500);
                }
            }
        });

        console.log('Paddle initialized successfully');
    } catch (error) {
        console.error('Paddle initialization failed:', error);
    }
} else {
    console.error('Paddle SDK not loaded');
}

/* ==============================================
   FREE VS PAID CHECK UI RENDERING
   ============================================== */
function renderChecks() {
    const resultsContainer = document.getElementById("results-container");
    resultsContainer.innerHTML = ""; // clear previous results

    const checks = [
        "Refund Policy Reference",
        "Clear Pricing Language",
        "Early Access Disclaimer",
        "Multiplayer / Network Disclaimer",
        "Controller Support Consistency",
        "VR Support Consistency",
        "Age-Sensitive Content Disclosure",
        "Screenshot Count",
        "Screenshot Aspect Ratio",
        "External Support Links"
    ];

    checks.forEach((check, index) => {
        const isLocked = !hasPaid && index >= FREE_LIMIT;

        // Create card container
        const card = document.createElement("div");
        card.className = "check-card" + (isLocked ? " locked" : "");

        // Badge
        const badge = document.createElement("span");
        badge.className = "check-badge";
        badge.textContent = isLocked ? "LOCKED" : "AVAILABLE";
        card.appendChild(badge);

        // Title
        const title = document.createElement("h3");
        title.textContent = check;
        card.appendChild(title);

        // Hint for locked checks
        if (isLocked) {
            const hint = document.createElement("p");
            hint.className = "check-hint";
            hint.textContent = "Unlock full access via one-time purchase";
            card.appendChild(hint);
        }

        resultsContainer.appendChild(card);
    });
}

/* ==============================================
   PADDLE CHECKOUT TRIGGER
   ============================================== */
function buyFullAccess() {
    Paddle.Checkout.open({
        product: PADDLE_PRICE_ID,
        title: "Steam Page Compliance Checker - Full Access",
        allowQuantity: false,
        sandbox: true // ensure sandbox mode
    });
}

/* ==============================================
   INITIALIZE ON PAGE LOAD
   ============================================== */
document.addEventListener("DOMContentLoaded", function() {
    renderChecks();
});

</script>

<!-- ==============================================
     CHECKS CONTAINER + PURCHASE BUTTON
     ============================================== -->
<div id="results-container" style="display:flex; flex-wrap:wrap; gap:16px; justify-content:center; padding:20px;"></div>

<div style="text-align:center; margin:20px;">
    <button onclick="buyFullAccess()" style="
        background-color:#0078d7;
        color:#fff;
        border:none;
        border-radius:8px;
        padding:12px 24px;
        font-size:16px;
        cursor:pointer;
    ">Unlock Full Checks</button>
</div>

<!-- ==============================================
     STYLING FOR CHECK CARDS
     ============================================== -->
<style>
.check-card {
    background-color: #1e1e1e;
    color: #e0e0e0;
    border-radius: 12px;
    padding: 12px 16px;
    width: 220px;
    box-shadow: 0 4px 8px rgba(0,0,0,0.3);
    transition: transform 0.2s;
    margin-bottom: 16px;
}

.check-card:hover { transform: translateY(-2px); }

.check-card.locked { opacity: 0.6; }

.check-badge {
    display: inline-block;
    padding: 4px 8px;
    border-radius: 8px;
    font-size: 12px;
    font-weight: bold;
    margin-bottom: 8px;
}

.check-card.locked .check-badge { background-color: #b04040; color: #fff; }
.check-card:not(.locked) .check-badge { background-color: #40b040; color: #fff; }

.check-hint {
    font-size: 12px;
    color: #aaaaaa;
    margin-top: 6px;
}

h3 { margin: 0; font-size: 16px; }
</style>
