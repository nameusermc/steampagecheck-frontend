<!DOCTYPE html>
<html lang="en">
<head>
  <link rel="stylesheet" href="style.css">
  <meta charset="UTF-8">
  <title>Steam Page Check</title>
</head>
<body>

  <div class="container">

    <div class="header">
      <h1>Steam Page Check</h1>
      <div class="accent"></div>
      <p>Preflight your Steam store page against common review expectations before submission. Advisory only — not affiliated with Valve.</p>
    </div>

    <label>Steam Store URL (public page)</label>
    <input id="steamUrl" type="text" placeholder="https://store.steampowered.com/app/123456">

    <label>Or paste your store page text</label>
    <textarea id="steamText" placeholder="Paste About This Game, Early Access notes, pricing info, etc."></textarea>

    <div class="buttons">
      <button onclick="runCheck()">Run Check</button>
      <button class="secondary" onclick="copyResults()">Copy Results</button>
      <button class="ghost" onclick="loadSample()">Load Test Example</button>
      <button class="ghost" onclick="toggleDarkMode()">Toggle Light/Dark</button>
      <button class="secondary" onclick="shareReport()">Share Report (coming soon)</button>
    </div>

    <div class="summary-bar" id="summaryBar"></div>

    <h2>Results</h2>
    <div id="output">No checks run yet.</div>

    <footer>steampagecheck.com · Not affiliated with Valve or Steam</footer>
  </div>

  <script>
    let darkMode = true; // default dark mode

    async function runCheck() {
      const url = document.getElementById("steamUrl").value.trim();
      const text = document.getElementById("steamText").value.trim();
      const output = document.getElementById("output");
      const summaryBar = document.getElementById("summaryBar");

      output.innerHTML = "Checking…";
      summaryBar.innerHTML = "";

      let payload;
      if (text) payload = { input_data: text, input_type: "text" };
      else if (url) payload = { input_data: url, input_type: "url" };
      else { output.innerHTML = "Please enter a URL or paste text."; return; }

      try {
        const res = await fetch("https://steampagecheck-backend.onrender.com/check", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify(payload)
        });

        const data = await res.json();
        output.innerHTML = "";

        const counts = data.severity_counts;
        if (counts.pass) summaryBar.innerHTML += `<span class="summary-pass">✅ Pass: ${counts.pass}</span>`;
        if (counts.warning) summaryBar.innerHTML += `<span class="summary-warning">⚠️ Warning: ${counts.warning}</span>`;
        if (counts.fail) summaryBar.innerHTML += `<span class="summary-fail">❌ Fail: ${counts.fail}</span>`;

        data.results.forEach(r => {
          const div = document.createElement("div");
          div.className = `result ${r.severity}`;
          let suggested = r.suggested_fix ? `<div class="suggested-fix">${r.suggested_fix}</div>` : "";
          let toggle = r.suggested_fix ? `<span class="toggle-fix" onclick="this.nextElementSibling.style.display=(this.nextElementSibling.style.display==='none'?'block':'none')">Show Fix</span>` : "";
          div.innerHTML = `
            <strong>${r.severity.toUpperCase()} — ${r.title}</strong>
            ${r.details || "No issues detected."}
            ${toggle}
            ${suggested}
          `;
          output.appendChild(div);
        });
      } catch {
        output.innerHTML = "Server error. Make sure the API is running.";
      }
    }

    function copyResults() {
      navigator.clipboard.writeText(document.getElementById("output").innerText);
      alert("Results copied to clipboard.");
    }

    function loadSample() {
      document.getElementById("steamText").value = `
Early Access multiplayer game.
Online features included.
Premium currency available.
Screenshots may be updated later.
      `;
      document.getElementById("steamUrl").value = "";
    }

    function toggleDarkMode() {
      darkMode = !darkMode;
      document.body.classList.toggle("light", !darkMode);
    }

    function shareReport() {
      alert("Shareable reports will be added in a future version!");
    }
  </script>
</body>
</html>
